<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>TwitCasting Access Token 발급기</title>
</head>
<body>
  <h2>TwitCasting Access Token 발급기</h2>
  <button id="authBtn">TwitCasting 인증하기</button>
  <pre id="result" style="white-space:pre-wrap; background:#f0f0f0; padding:1em; margin-top:1em;"></pre>

  <script>
    const client_id = "1648664071259189248.eec88a0a57541648e516b4c05af34308e80a14ac07baed118e678c6c989b980e";
    const client_secret = "5f49beb909a4cc679412a9421c06bff3bfd210c57dbe84095ac3c079c7b72c7d";
    const redirect_uri = "https://j850704.github.io/twitcasting-oauth/";
    const auth_url = `https://apiv2.twitcasting.tv/oauth2/authorize?response_type=code&client_id=${client_id}&redirect_uri=${encodeURIComponent(redirect_uri)}`;

    document.getElementById("authBtn").onclick = () => {
      window.location.href = auth_url;
    };

    async function exchangeCodeForToken(code) {
      const params = new URLSearchParams();
      params.append("grant_type", "authorization_code");
      params.append("client_id", client_id);
      params.append("client_secret", client_secret);
      params.append("code", code);
      params.append("redirect_uri", redirect_uri);

      const response = await fetch("https://apiv2.twitcasting.tv/oauth2/token", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: params,
      });

      const data = await response.json();
      document.getElementById("result").textContent = JSON.stringify(data, null, 2);
    }

    const query = new URLSearchParams(window.location.search);
    const code = query.get("code");
    if (code) {
      exchangeCodeForToken(code);
    }
  </script>
</body>
</html>
